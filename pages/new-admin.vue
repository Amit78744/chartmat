<template>
  <div class="flex flex-col min-h-screen bg-gray-100">
    <div class="bg-slate-900 text-white p-6 flex justify-between items-center">
      <div class="inline-flex items-center">
        <a class="text-white mr-3">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 stroke-current"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z"
            />
          </svg>
        </a>
        <div class="border-l border-slate-700 pl-3">
          <p class="text-2xl font-bold">Chartmat Admin</p>
          <p class="text-sm opacity-80">
            Manage Users, Settings & Boards for Chartmat
          </p>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-12 gap-4 h-full md:h-full">
      <sidebar
        class="bg-white md:col-span-2 p-5 px-4 py-6 border border-black-300 rounded-lg overflow-auto max-h-screen"
      >
        <div class="workspace-container">
          <div class="workspace-header py-2">
            <h2 class="text-base font-bold">Add New Workspace</h2>
            <div class="circle-button">
              <button @click="togglePopup('isAddPopupVisible')">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="currentColor"
                  class="bi bi-plus"
                  viewBox="0 0 16 16"
                >
                  <path
                    d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"
                  />
                </svg>
              </button>
              <div v-if="isAddPopupVisible" class="add-popup-overlay">
                <div class="add-popup-content">
                  <boardDemo></boardDemo>
                  <button
                    class="add-close-btn"
                    @click="togglePopup('isAddPopupVisible')"
                  >
                    X
                  </button>
                </div>
              </div>
            </div>
          </div>
          <p class="text-sm mt-3">
            Each workspace has different users, different custom domains, and
            you can even connect a different Google account. In each workspace,
            you can add unlimited boards with unlimited blocks.
          </p>
        </div>

        <!-- Workspace  Section -->
        <div
          v-for="(workspace, index) in workspaces"
          :key="workspace.id"
          class="mt-4"
        >
          <div
            class="workspace-header cursor-pointer flex items-center justify-between"
            @click="toggleWorkspace(index)"
          >
            <div
              :class="{
                'selected-class':
                  selectedWorkspace && selectedWorkspace.id === workspace.id,
              }"
              @click="selectWorkspace(workspace)"
            >
              <span class="text-md block font-medium truncate">
                {{ workspace.name }}
              </span>
            </div>

            <span
              :class="{
                'arrow-down': !workspace.collapsed,
                'arrow-right': workspace.collapsed,
              }"
              class="toggle-arrow"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 18 18"
                fill="none"
              >
                <path
                  d="M4.26707 16.0796L11.3466 9.00006L4.26707 1.92054C4.05821 1.70912 3.94149 1.42365 3.94239 1.12647C3.94329 0.829284 4.06175 0.54453 4.27189 0.334388C4.48203 0.124246 4.76678 0.00579012 5.06397 0.004888C5.36115 0.00398589 5.64662 0.120711 5.85803 0.329573L13.733 8.20458C13.944 8.41556 14.0625 8.7017 14.0625 9.00006C14.0625 9.29842 13.944 9.58456 13.733 9.79554L5.85803 17.6705C5.64662 17.8794 5.36115 17.9961 5.06397 17.9952C4.76678 17.9943 4.48203 17.8759 4.27189 17.6657C4.06175 17.4556 3.94329 17.1708 3.94239 16.8737C3.94149 16.5765 4.05821 16.291 4.26707 16.0796Z"
                  fill="black"
                /></svg
            ></span>
          </div>

          <ul
            v-if="!workspace.collapsed"
            class="workspace-details text-sm space-y-4 text-center text-slate-500 mt-4 border-t border-gray-100 pt-3"
          >
            <li class="workspace-item">
              <p class="flex items-center">
                <svg
                  class="w-6 h-6 mr-3 flex-shrink-0 stroke-current"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
                  ></path>
                </svg>
                Templates
              </p>
            </li>
            <li class="workspace-item">
              <p
                v-show="workspace.created_by === $auth.user.id"
                class="flex items-center"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 mr-3 flex-shrink-0 stroke-current"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
                  />
                </svg>
                You are the owner
              </p>
              <p
                v-show="workspace.created_by !== $auth.user.id"
                class="flex items-center"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 mr-3 flex-shrink-0 stroke-current"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M20.618 5.984A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016zM12 9v2m0 4h.01"
                  />
                </svg>
                You have been added to this workspace
              </p>
            </li>
            <li class="workspace-item">
              <p class="flex items-center">
                <svg
                  class="h-6 w-6 mr-3 flex-shrink-0 stroke-current"
                  xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  viewBox="0 0 48 48"
                >
                  <defs>
                    <path
                      id="a"
                      d="M44.5 20H24v8.5h11.8C34.7 33.9 30.1 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 4.1 29.6 2 24 2 11.8 2 2 11.8 2 24s9.8 22 22 22c11 0 21-8 21-22 0-1.3-.2-2.7-.5-4z"
                    />
                  </defs>
                  <clipPath id="b">
                    <use xlink:href="#a" overflow="visible" />
                  </clipPath>
                  <path
                    clip-path="url(#b)"
                    fill="#FBBC05"
                    d="M0 37V11l17 13z"
                  />
                  <path
                    clip-path="url(#b)"
                    fill="#EA4335"
                    d="M0 11l17 13 7-6.1L48 14V0H0z"
                  />
                  <path
                    clip-path="url(#b)"
                    fill="#34A853"
                    d="M0 37l30-23 7.9 1L48 0v48H0z"
                  />
                  <path
                    clip-path="url(#b)"
                    fill="#4285F4"
                    d="M48 48L17 24l-4-3 35-10z"
                  />
                </svg>
                <span>{{ workspace.token_email || "Not Connected" }}</span>
              </p>
            </li>
            <li class="workspace-item">
              <p class="flex items-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 mr-3"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
                  />
                </svg>
                <span
                  >{{ workspace.boards.length }}
                  {{ workspace.boards.length > 1 ? "Boards" : "Board" }}</span
                >
              </p>
            </li>
            <li class="workspace-item">
              <div class="flex items-center text-left">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 mr-3 flex-shrink-0 stroke-current"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                  />
                </svg>
                <div>
                  <div>
                    <p class="block font-medium">Admins:</p>
                    <p v-if="users[workspace.id].admins.length">
                      {{ users[workspace.id].admins }}
                    </p>
                    <p v-else>None</p>
                  </div>
                  <div class="mt-2">
                    <p class="block font-medium">Guests:</p>
                    <p v-if="users[workspace.id].guests.length">
                      {{ users[workspace.id].guests }}
                    </p>
                    <p v-else>None</p>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </sidebar>

      <main
        class="main md:col-span-10 p-4 px-4 py-6 border border-black-300 rounded-lg h-screen overflow-y-auto"
      >
        <section class="mb-8">
          <div class="flex justify-between items-start">
            <h2 class="text-md block font-medium mb-3 ml-6">
              Create New Board
            </h2>
            <div class="flex items-center space-x-3 relative group">
              <button>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 stroke-current text-gray-800"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
                </svg>
              </button>
              <div
                class="hidden group-hover:block absolute rounded p-3 bg-white border border-gray-200 shadow-lg right-0 text-black max-w-sm"
              >
                <p>
                  You are logged in the workspace
                  <b class="bold">{{ workspace.name }}</b> with the email
                  {{ email }}
                </p>
                <button @click="logout" class="btn btn-red w-full mt-4">
                  Logout
                  <span class="hidden sm:flex"
                    >&nbsp; from {{ workspace.name }}</span
                  >
                </button>
              </div>
              <div class="flex flex-col">
                <span class="font-medium text-gray-800">Account</span>
                <span class="text-sm text-gray-600">{{ email }}</span>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-12 gap-4 ml-6">
            <div
              class="main border border-yellow-400 sm:col-span-12 lg:col-span-3 rounded-md"
            >
              <div class="text-black p-6 flex justify-between items-center">
                <div class="inline-flex items-center">
                  <a class="text-yellow-400 mr-3">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="70"
                      height="70"
                      viewBox="0 0 70 70"
                      fill="none"
                    >
                      <mask
                        id="mask0_342_19"
                        style="mask-type: alpha"
                        maskUnits="userSpaceOnUse"
                        x="13"
                        y="13"
                        width="43"
                        height="44"
                      >
                        <path
                          d="M29.5312 39.375H16.4062C15.5363 39.374 14.7023 39.028 14.0871 38.4129C13.472 37.7977 13.126 36.9637 13.125 36.0938V16.4062C13.126 15.5363 13.472 14.7023 14.0871 14.0871C14.7023 13.472 15.5363 13.126 16.4062 13.125H29.5312C30.4012 13.126 31.2352 13.472 31.8504 14.0871C32.4655 14.7023 32.8115 15.5363 32.8125 16.4062V36.0938C32.8115 36.9637 32.4655 37.7977 31.8504 38.4129C31.2352 39.028 30.4012 39.374 29.5312 39.375ZM16.4062 15.3125C16.1162 15.3128 15.8382 15.4281 15.6331 15.6331C15.4281 15.8382 15.3128 16.1162 15.3125 16.4062V36.0938C15.3128 36.3838 15.4281 36.6618 15.6331 36.8669C15.8382 37.0719 16.1162 37.1872 16.4062 37.1875H29.5312C29.8213 37.1872 30.0993 37.0719 30.3044 36.8669C30.5094 36.6618 30.6247 36.3838 30.625 36.0938V16.4062C30.6247 16.1162 30.5094 15.8382 30.3044 15.6331C30.0993 15.4281 29.8213 15.3128 29.5312 15.3125H16.4062Z"
                          fill="black"
                        />
                        <path
                          d="M29.5312 56.875H16.4062C15.5363 56.874 14.7023 56.528 14.0871 55.9129C13.472 55.2977 13.126 54.4637 13.125 53.5938V44.8438C13.126 43.9738 13.472 43.1398 14.0871 42.5246C14.7023 41.9095 15.5363 41.5635 16.4062 41.5625H29.5312C30.4012 41.5635 31.2352 41.9095 31.8504 42.5246C32.4655 43.1398 32.8115 43.9738 32.8125 44.8438V53.5938C32.8115 54.4637 32.4655 55.2977 31.8504 55.9129C31.2352 56.528 30.4012 56.874 29.5312 56.875ZM16.4062 43.75C16.1162 43.7503 15.8382 43.8656 15.6331 44.0706C15.4281 44.2757 15.3128 44.5537 15.3125 44.8438V53.5938C15.3128 53.8838 15.4281 54.1618 15.6331 54.3669C15.8382 54.5719 16.1162 54.6872 16.4062 54.6875H29.5312C29.8213 54.6872 30.0993 54.5719 30.3044 54.3669C30.5094 54.1618 30.6247 53.8838 30.625 53.5938V44.8438C30.6247 44.5537 30.5094 44.2757 30.3044 44.0706C30.0993 43.8656 29.8213 43.7503 29.5312 43.75H16.4062Z"
                          fill="black"
                        />
                        <path
                          d="M52.5 56.875H39.375C38.5051 56.874 37.671 56.528 37.0559 55.9129C36.4407 55.2977 36.0947 54.4637 36.0938 53.5938V33.9062C36.0947 33.0363 36.4407 32.2023 37.0559 31.5871C37.671 30.972 38.5051 30.626 39.375 30.625H52.5C53.3699 30.626 54.204 30.972 54.8191 31.5871C55.4343 32.2023 55.7803 33.0363 55.7812 33.9062V53.5938C55.7803 54.4637 55.4343 55.2977 54.8191 55.9129C54.204 56.528 53.3699 56.874 52.5 56.875ZM39.375 32.8125C39.085 32.8128 38.807 32.9281 38.6019 33.1331C38.3968 33.3382 38.2815 33.6162 38.2812 33.9062V53.5938C38.2815 53.8838 38.3968 54.1618 38.6019 54.3669C38.807 54.5719 39.085 54.6872 39.375 54.6875H52.5C52.79 54.6872 53.068 54.5719 53.2731 54.3669C53.4782 54.1618 53.5935 53.8838 53.5938 53.5938V33.9062C53.5935 33.6162 53.4782 33.3382 53.2731 33.1331C53.068 32.9281 52.79 32.8128 52.5 32.8125H39.375Z"
                          fill="black"
                        />
                        <path
                          d="M52.5 28.4375H39.375C38.5051 28.4365 37.671 28.0905 37.0559 27.4754C36.4407 26.8602 36.0947 26.0262 36.0938 25.1562V16.4062C36.0947 15.5363 36.4407 14.7023 37.0559 14.0871C37.671 13.472 38.5051 13.126 39.375 13.125H52.5C53.3699 13.126 54.204 13.472 54.8191 14.0871C55.4343 14.7023 55.7803 15.5363 55.7812 16.4062V25.1562C55.7803 26.0262 55.4343 26.8602 54.8191 27.4754C54.204 28.0905 53.3699 28.4365 52.5 28.4375ZM39.375 15.3125C39.085 15.3128 38.807 15.4281 38.6019 15.6331C38.3968 15.8382 38.2815 16.1162 38.2812 16.4062V25.1562C38.2815 25.4463 38.3968 25.7243 38.6019 25.9294C38.807 26.1344 39.085 26.2497 39.375 26.25H52.5C52.79 26.2497 53.068 26.1344 53.2731 25.9294C53.4782 25.7243 53.5935 25.4463 53.5938 25.1562V16.4062C53.5935 16.1162 53.4782 15.8382 53.2731 15.6331C53.068 15.4281 52.79 15.3128 52.5 15.3125H39.375Z"
                          fill="black"
                        />
                      </mask>
                      <g mask="url(#mask0_342_19)">
                        <rect width="70" height="70" fill="#EBA53D" />
                      </g>
                    </svg>
                  </a>
                  <div>
                    <button
                      @click="togglePopup('isStartFromScratchPopupVisible')"
                    >
                      <div class="border-l border-slate-700 pl-3">
                        <p class="text-1xl block font-medium">
                          Start from scratch
                        </p>
                      </div>
                      <p class="text-sm opacity-80 border-l border-slate-700">
                        Start to simple
                      </p>
                    </button>
                    <div
                      v-if="isStartFromScratchPopupVisible"
                      class="popup-overlay"
                    >
                      <div class="popup-content">
                        <button
                          class="close-btn"
                          @click="togglePopup('isStartFromScratchPopupVisible')"
                        >
                          X
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="main border border-green-400 sm:col-span-12 lg:col-span-3 rounded-md"
            >
              <div class="text-black p-6 flex justify-between items-center">
                <div class="inline-flex items-center">
                  <a class="text-green-400 mr-3">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="70"
                      height="70"
                      viewBox="0 0 70 70"
                      fill="none"
                    >
                      <mask
                        id="mask0_342_33"
                        style="mask-type: alpha"
                        maskUnits="userSpaceOnUse"
                        x="15"
                        y="15"
                        width="40"
                        height="40"
                      >
                        <path
                          d="M32.1429 15H16.4286C16.0497 15 15.6863 15.1505 15.4184 15.4184C15.1505 15.6863 15 16.0497 15 16.4286V32.1429C15 32.5217 15.1505 32.8851 15.4184 33.153C15.6863 33.4209 16.0497 33.5714 16.4286 33.5714H32.1429C32.5217 33.5714 32.8851 33.4209 33.153 33.153C33.4209 32.8851 33.5714 32.5217 33.5714 32.1429V16.4286C33.5714 16.0497 33.4209 15.6863 33.153 15.4184C32.8851 15.1505 32.5217 15 32.1429 15ZM30.7143 30.7143H17.8571V17.8571H30.7143V30.7143ZM53.5714 36.4286H37.8571C37.4783 36.4286 37.1149 36.5791 36.847 36.847C36.5791 37.1149 36.4286 37.4783 36.4286 37.8571V53.5714C36.4286 53.9503 36.5791 54.3137 36.847 54.5816C37.1149 54.8495 37.4783 55 37.8571 55H53.5714C53.9503 55 54.3137 54.8495 54.5816 54.5816C54.8495 54.3137 55 53.9503 55 53.5714V37.8571C55 37.4783 54.8495 37.1149 54.5816 36.847C54.3137 36.5791 53.9503 36.4286 53.5714 36.4286ZM52.1429 52.1429H39.2857V39.2857H52.1429V52.1429ZM33.5714 40.7143C33.5714 41.0932 33.4209 41.4565 33.153 41.7244C32.8851 41.9923 32.5217 42.1429 32.1429 42.1429H16.4286C16.0497 42.1429 15.6863 41.9923 15.4184 41.7244C15.1505 41.4565 15 41.0932 15 40.7143C15 40.3354 15.1505 39.972 15.4184 39.7041C15.6863 39.4362 16.0497 39.2857 16.4286 39.2857H32.1429C32.5217 39.2857 32.8851 39.4362 33.153 39.7041C33.4209 39.972 33.5714 40.3354 33.5714 40.7143ZM33.5714 50.7143C33.5714 51.0932 33.4209 51.4565 33.153 51.7244C32.8851 51.9923 32.5217 52.1429 32.1429 52.1429H16.4286C16.0497 52.1429 15.6863 51.9923 15.4184 51.7244C15.1505 51.4565 15 51.0932 15 50.7143C15 50.3354 15.1505 49.972 15.4184 49.7041C15.6863 49.4362 16.0497 49.2857 16.4286 49.2857H32.1429C32.5217 49.2857 32.8851 49.4362 33.153 49.7041C33.4209 49.972 33.5714 50.3354 33.5714 50.7143ZM36.4286 19.2857C36.4286 18.9068 36.5791 18.5435 36.847 18.2756C37.1149 18.0077 37.4783 17.8571 37.8571 17.8571H53.5714C53.9503 17.8571 54.3137 18.0077 54.5816 18.2756C54.8495 18.5435 55 18.9068 55 19.2857C55 19.6646 54.8495 20.028 54.5816 20.2959C54.3137 20.5638 53.9503 20.7143 53.5714 20.7143H37.8571C37.4783 20.7143 37.1149 20.5638 36.847 20.2959C36.5791 20.028 36.4286 19.6646 36.4286 19.2857ZM55 29.2857C55 29.6646 54.8495 30.028 54.5816 30.2959C54.3137 30.5638 53.9503 30.7143 53.5714 30.7143H37.8571C37.4783 30.7143 37.1149 30.5638 36.847 30.2959C36.5791 30.028 36.4286 29.6646 36.4286 29.2857C36.4286 28.9068 36.5791 28.5435 36.847 28.2756C37.1149 28.0077 37.4783 27.8571 37.8571 27.8571H53.5714C53.9503 27.8571 54.3137 28.0077 54.5816 28.2756C54.8495 28.5435 55 28.9068 55 29.2857Z"
                          fill="black"
                        />
                      </mask>
                      <g mask="url(#mask0_342_33)">
                        <rect
                          x="15"
                          y="15"
                          width="40"
                          height="40"
                          fill="#37D250"
                        />
                      </g>
                    </svg>
                  </a>
                  <!-- <div class="border-l border-slate-700 pl-3">
                    <p class="text-1xl block font-medium">
                      Start from templates
                    </p>
                    <p class="text-sm opacity-80">Start to simple</p>
                  </div> -->
                  <div>
                    <button
                      @click="togglePopup('isStartFromTemplatesPopupVisible')"
                    >
                      <div class="border-l border-slate-700 pl-3">
                        <p class="text-1xl block font-medium">
                          Start from templates
                        </p>
                        <p class="text-sm opacity-80">Start to simple</p>
                      </div>
                    </button>
                    <div
                      v-if="isStartFromTemplatesPopupVisible"
                      class="popup-overlay"
                    >
                      <div class="popup-content">
                        <button
                          class="close-btn"
                          @click="
                            togglePopup('isStartFromTemplatesPopupVisible')
                          "
                        >
                          X
                        </button>
                        <boardNew :workspace="selectWorkspace"></boardNew>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="main border border-red-400 sm:col-span-12 lg:col-span-3 rounded-md"
            >
              <div class="text-black p-6 flex justify-between items-center">
                <div class="inline-flex items-center">
                  <a class="text-red-400 mr-3 mt-4">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="60"
                      height="60"
                      viewBox="0 0 70 70"
                      fill="none"
                    >
                      <mask
                        id="mask0_342_51"
                        style="mask-type: alpha"
                        maskUnits="userSpaceOnUse"
                        x="1"
                        y="1"
                        width="55"
                        height="55"
                      >
                        <path
                          d="M1.72754 5.58568V2.27256C1.73039 2.12877 1.78877 1.99167 1.89047 1.88998C1.99216 1.78829 2.12926 1.7299 2.27305 1.72705H54.6195C54.7633 1.7299 54.9004 1.78829 55.0021 1.88998C55.1038 1.99167 55.1622 2.12877 55.165 2.27256V5.58568C55.1622 5.72946 55.1038 5.86657 55.0021 5.96826C54.9004 6.06995 54.7633 6.12834 54.6195 6.13118H2.27305C2.12926 6.12834 1.99216 6.06995 1.89047 5.96826C1.78877 5.86657 1.73039 5.72946 1.72754 5.58568Z"
                          stroke="black"
                          stroke-miterlimit="10"
                        />
                        <path
                          d="M4.875 38.4652V7.91113H52.018V38.4652C52.018 39.1147 51.7599 39.7377 51.3006 40.197C50.8413 40.6563 50.2183 40.9144 49.5687 40.9144H7.32422C6.67464 40.9144 6.05168 40.6563 5.59236 40.197C5.13304 39.7377 4.875 39.1147 4.875 38.4652Z"
                          stroke="black"
                          stroke-width="3"
                          stroke-miterlimit="10"
                        />
                        <path
                          d="M39.0741 47.5611H17.8193L18.6409 45.0752H38.2525L39.0741 47.5611Z"
                          stroke="black"
                          stroke-miterlimit="10"
                        />
                        <path
                          d="M12.8603 54.4965C12.7829 54.7326 12.6179 54.9301 12.3994 55.0484C12.1809 55.1667 11.9253 55.1968 11.6853 55.1325C11.4453 55.0683 11.239 54.9145 11.1088 54.7028C10.9787 54.4911 10.9345 54.2376 10.9855 53.9944L13.3234 42.7002H16.7612L12.8603 54.4965Z"
                          stroke="black"
                          stroke-miterlimit="10"
                        />
                        <path
                          d="M16.5713 52.1958L17.1859 49.8208H39.7066L40.3213 52.1958H16.5713Z"
                          stroke="black"
                          stroke-miterlimit="10"
                        />
                        <path
                          d="M45.9047 53.9945C45.951 54.2357 45.9042 54.4854 45.7739 54.6935C45.6435 54.9017 45.4392 55.0527 45.202 55.1163C44.9648 55.1799 44.7123 55.1513 44.4953 55.0364C44.2783 54.9214 44.1128 54.7286 44.0322 54.4966L40.1279 42.6958H43.5657L45.9047 53.9945Z"
                          stroke="black"
                          stroke-miterlimit="10"
                        />
                        <path
                          d="M20.8527 30.9955C20.5224 30.9946 20.1973 31.0773 19.9076 31.2359C18.5201 29.4534 17.7118 27.2888 17.5911 25.0332C17.4704 22.7776 18.0433 20.5392 19.2326 18.6188C20.4219 16.6985 22.1707 15.1883 24.2438 14.2913C26.3169 13.3944 28.6149 13.1536 30.8289 13.6015C30.9493 13.6228 31.0732 13.5961 31.1742 13.5272C31.2752 13.4584 31.3454 13.3528 31.3696 13.2329C31.3939 13.1131 31.3704 12.9885 31.3041 12.8858C31.2378 12.7831 31.134 12.7103 31.0148 12.6831C30.2287 12.5245 29.4287 12.4447 28.6268 12.4448C26.3741 12.4451 24.1671 13.0797 22.2584 14.2761C20.3496 15.4724 18.8164 17.182 17.8341 19.2093C16.8519 21.2365 16.4604 23.4993 16.7044 25.7387C16.9484 27.9781 17.8181 30.1035 19.214 31.8716C18.9703 32.2367 18.8556 32.6728 18.8881 33.1106C18.9206 33.5484 19.0984 33.9627 19.3933 34.2879C19.6882 34.6131 20.0833 34.8304 20.5158 34.9053C20.9483 34.9803 21.3935 34.9086 21.7806 34.7016C22.1677 34.4946 22.4746 34.1643 22.6525 33.7629C22.8304 33.3616 22.8691 32.9124 22.7625 32.4865C22.6559 32.0607 22.4101 31.6827 22.0641 31.4126C21.7181 31.1424 21.2917 30.9956 20.8527 30.9955ZM21.5808 33.6918C21.4121 33.8608 21.19 33.9661 20.9524 33.9896C20.7147 34.0132 20.4763 33.9536 20.2777 33.8211C20.079 33.6885 19.9325 33.4912 19.8631 33.2627C19.7936 33.0342 19.8056 32.7888 19.8969 32.5681C19.9882 32.3474 20.1532 32.1653 20.3637 32.0526C20.5743 31.94 20.8174 31.9039 21.0516 31.9504C21.2858 31.997 21.4967 32.1233 21.6482 32.3079C21.7997 32.4924 21.8825 32.7238 21.8825 32.9626C21.8828 33.0981 21.8563 33.2322 21.8045 33.3574C21.7528 33.4825 21.6767 33.5962 21.5808 33.6918Z"
                          fill="black"
                        />
                        <path
                          d="M38.0397 17.0052C38.3055 16.6053 38.4157 16.122 38.3494 15.6464C38.2832 15.1709 38.0451 14.7361 37.6801 14.4241C37.3152 14.1121 36.8486 13.9445 36.3686 13.9529C35.8885 13.9614 35.4282 14.1454 35.0745 14.4701C34.7208 14.7948 34.4982 15.2377 34.4488 15.7153C34.3993 16.1929 34.5265 16.6721 34.8062 17.0623C35.0859 17.4526 35.4989 17.7269 35.967 17.8335C36.4352 17.9401 36.9262 17.8716 37.3473 17.6409C38.735 19.4222 39.5442 21.5855 39.6662 23.8402C39.7882 26.0949 39.2171 28.333 38.0296 30.2535C36.8422 32.1741 35.0953 33.6852 33.0237 34.5837C30.9522 35.4822 28.6552 35.7251 26.4416 35.2797C26.3196 35.2553 26.193 35.2804 26.0896 35.3494C25.9861 35.4184 25.9143 35.5257 25.8899 35.6476C25.8656 35.7696 25.8907 35.8962 25.9597 35.9997C26.0287 36.1031 26.1359 36.1749 26.2579 36.1993C27.0365 36.3543 27.8286 36.4322 28.6225 36.4319C30.8751 36.4317 33.0822 35.797 34.9909 34.6007C36.8996 33.4044 38.4329 31.6948 39.4151 29.6675C40.3974 27.6403 40.7889 25.3775 40.5449 23.1381C40.3008 20.8987 39.4311 18.7733 38.0353 17.0052H38.0397ZM35.6729 16.6456C35.5042 16.477 35.3992 16.2552 35.3757 16.0178C35.3523 15.7805 35.4118 15.5424 35.5442 15.344C35.6767 15.1457 35.8738 14.9994 36.102 14.93C36.3302 14.8607 36.5754 14.8727 36.7957 14.9638C37.0161 15.055 37.1981 15.2198 37.3106 15.4301C37.4231 15.6404 37.4592 15.8832 37.4128 16.1171C37.3664 16.351 37.2403 16.5616 37.056 16.713C36.8717 16.8644 36.6406 16.9472 36.4021 16.9473C36.2666 16.9478 36.1324 16.9214 36.0072 16.8696C35.8821 16.8178 35.7684 16.7417 35.6729 16.6456Z"
                          fill="black"
                        />
                        <path
                          d="M26.6953 32.4962C26.6951 32.5577 26.7071 32.6186 26.7306 32.6755C26.754 32.7323 26.7884 32.784 26.8318 32.8275C26.8753 32.8711 26.9269 32.9056 26.9837 32.9292C27.0405 32.9528 27.1014 32.9649 27.1629 32.9649H30.093C30.2173 32.9649 30.3365 32.9155 30.4244 32.8276C30.5123 32.7397 30.5617 32.6205 30.5617 32.4962V31.5878C31.1769 31.4227 31.7679 31.1779 32.3196 30.8597L32.9608 31.5009C33.0487 31.5887 33.1678 31.638 33.292 31.638C33.4162 31.638 33.5354 31.5887 33.6232 31.5009L35.6939 29.4291C35.7817 29.3412 35.831 29.2221 35.831 29.0979C35.831 28.9737 35.7817 28.8546 35.6939 28.7667L35.0538 28.1254C35.3716 27.5735 35.6163 26.9826 35.7819 26.3676H36.6848C36.809 26.3673 36.928 26.3178 37.0159 26.23C37.1037 26.1421 37.1532 26.0231 37.1535 25.8989V22.9698C37.1535 22.8455 37.1041 22.7263 37.0162 22.6384C36.9283 22.5505 36.8091 22.5011 36.6848 22.5011H35.7797C35.6141 21.8861 35.3694 21.2952 35.0516 20.7433L35.6884 20.1054C35.7327 20.0617 35.7679 20.0098 35.7919 19.9524C35.8159 19.8951 35.8282 19.8335 35.8282 19.7714C35.8282 19.7092 35.8159 19.6477 35.7919 19.5903C35.7679 19.533 35.7327 19.481 35.6884 19.4374L33.6154 17.3667C33.5276 17.2789 33.4084 17.2296 33.2842 17.2296C33.16 17.2296 33.0409 17.2789 32.953 17.3667L32.3174 18.0035C31.7659 17.6874 31.1757 17.4442 30.5617 17.2798V16.3803C30.5614 16.2561 30.512 16.1371 30.4241 16.0492C30.3363 15.9614 30.2172 15.9119 30.093 15.9116H27.1629C27.0388 15.9119 26.9198 15.9614 26.8322 16.0493C26.7445 16.1372 26.6953 16.2562 26.6953 16.3803V17.2798C26.0798 17.4456 25.4885 17.6907 24.9363 18.009L24.3006 17.3722C24.2127 17.2845 24.0936 17.2352 23.9694 17.2352C23.8452 17.2352 23.7261 17.2845 23.6382 17.3722L21.5664 19.443C21.522 19.4865 21.4867 19.5385 21.4626 19.5958C21.4385 19.6531 21.4261 19.7147 21.4261 19.7769C21.4261 19.8391 21.4385 19.9007 21.4626 19.9581C21.4867 20.0154 21.522 20.0674 21.5664 20.1109L22.2043 20.7488C21.8857 21.3005 21.6406 21.8915 21.4751 22.5067H20.5722C20.5108 22.5066 20.4498 22.5185 20.393 22.542C20.3361 22.5654 20.2844 22.5998 20.2409 22.6433C20.1974 22.6867 20.1628 22.7383 20.1393 22.7951C20.1157 22.8519 20.1036 22.9128 20.1036 22.9743V25.9044C20.1027 25.9665 20.1144 26.028 20.138 26.0854C20.1615 26.1428 20.1964 26.1948 20.2405 26.2384C20.2843 26.2824 20.3363 26.3172 20.3936 26.3409C20.451 26.3646 20.5124 26.3767 20.5745 26.3765H21.4796C21.645 26.9917 21.8902 27.5827 22.2088 28.1343L21.5675 28.7756C21.4798 28.8635 21.4305 28.9826 21.4305 29.1068C21.4305 29.231 21.4798 29.3501 21.5675 29.438L23.6382 31.5098C23.6821 31.5536 23.7342 31.5882 23.7915 31.6117C23.8488 31.6352 23.9102 31.6471 23.9722 31.6468C24.0342 31.6472 24.0956 31.6353 24.1529 31.6118C24.2103 31.5883 24.2624 31.5536 24.3062 31.5098L24.9474 30.8686C25.4995 31.187 26.0908 31.4318 26.7064 31.5967L26.6953 32.4962ZM25.12 29.8744C25.03 29.8163 24.9227 29.7908 24.8162 29.8021C24.7096 29.8135 24.6102 29.861 24.5344 29.9368L23.9644 30.5068L22.5561 29.0973L23.1261 28.5273C23.2017 28.4515 23.2491 28.352 23.2604 28.2455C23.2718 28.139 23.2464 28.0318 23.1885 27.9418C22.7635 27.2884 22.4616 26.5629 22.2978 25.8009C22.2752 25.696 22.2174 25.6021 22.1339 25.5346C22.0505 25.4672 21.9465 25.4303 21.8392 25.4302H21.0343V23.4363H21.838C21.9452 23.4364 22.0492 23.3998 22.1327 23.3326C22.2162 23.2653 22.2741 23.1715 22.2967 23.0667C22.4607 22.3044 22.7625 21.5785 23.1873 20.9247C23.2452 20.8348 23.2705 20.7278 23.2592 20.6215C23.2478 20.5152 23.2005 20.416 23.125 20.3403L22.5583 19.7736L23.9678 18.3653L24.5333 18.9308C24.6091 19.0066 24.7085 19.0541 24.8151 19.0655C24.9216 19.0768 25.0289 19.0513 25.1189 18.9932C25.7729 18.5688 26.4987 18.267 27.2608 18.1026C27.3655 18.0801 27.4593 18.0225 27.5266 17.9392C27.5939 17.8559 27.6305 17.7521 27.6304 17.645V16.8446H29.6232V17.6472C29.6231 17.7544 29.6597 17.8584 29.727 17.9419C29.7942 18.0254 29.8881 18.0832 29.9928 18.1059C30.7552 18.2697 31.4811 18.5715 32.1348 18.9965C32.2248 19.0546 32.332 19.0802 32.4386 19.0688C32.5451 19.0575 32.6446 19.0099 32.7204 18.9342L33.2859 18.3686L34.6953 19.7769L34.1287 20.3425C34.0531 20.4184 34.0057 20.5178 33.9944 20.6243C33.983 20.7308 34.0084 20.838 34.0663 20.9281C34.4906 21.5821 34.7924 22.3079 34.957 23.07C34.9794 23.1747 35.0371 23.2685 35.1203 23.3358C35.2036 23.4031 35.3075 23.4397 35.4145 23.4396H36.2194V25.4324H35.4145C35.3074 25.4326 35.2035 25.4695 35.1202 25.5369C35.037 25.6044 34.9794 25.6983 34.957 25.8031C34.7924 26.5649 34.4906 27.2903 34.0663 27.944C34.0084 28.0341 33.983 28.1413 33.9944 28.2478C34.0057 28.3543 34.0531 28.4537 34.1287 28.5296L34.6987 29.0996L33.2904 30.509L32.7204 29.939C32.6448 29.8628 32.5453 29.8151 32.4387 29.8037C32.332 29.7924 32.2247 29.8181 32.1348 29.8766C31.4805 30.3005 30.7548 30.6023 29.9928 30.7673C29.8882 30.7897 29.7943 30.8474 29.7271 30.9306C29.6598 31.0139 29.6231 31.1178 29.6232 31.2248V32.0331H27.6304V31.2248C27.6305 31.1178 27.5939 31.0139 27.5266 30.9306C27.4593 30.8474 27.3655 30.7897 27.2608 30.7673C26.499 30.602 25.7735 30.2994 25.12 29.8744Z"
                          fill="black"
                        />
                        <path
                          d="M32.4976 24.4378C32.4976 23.6722 32.2706 22.9238 31.8453 22.2872C31.4199 21.6507 30.8154 21.1545 30.1081 20.8615C29.4007 20.5686 28.6224 20.4919 27.8716 20.6413C27.1207 20.7906 26.431 21.1593 25.8896 21.7006C25.3483 22.242 24.9796 22.9317 24.8302 23.6826C24.6809 24.4335 24.7575 25.2118 25.0505 25.9191C25.3435 26.6264 25.8396 27.231 26.4762 27.6563C27.1128 28.0816 27.8612 28.3087 28.6267 28.3087C29.653 28.3075 30.6369 27.8993 31.3626 27.1736C32.0882 26.4479 32.4964 25.464 32.4976 24.4378ZM25.6932 24.4378C25.6932 23.8573 25.8654 23.2899 26.1879 22.8073C26.5104 22.3247 26.9688 21.9485 27.5051 21.7264C28.0414 21.5044 28.6315 21.4463 29.2008 21.5596C29.7701 21.673 30.293 21.9526 30.7033 22.3631C31.1137 22.7736 31.3931 23.2966 31.5062 23.8659C31.6193 24.4353 31.561 25.0254 31.3388 25.5616C31.1165 26.0978 30.7402 26.556 30.2574 26.8784C29.7747 27.2007 29.2072 27.3726 28.6267 27.3724C27.8488 27.3715 27.103 27.062 26.553 26.5118C26.0031 25.9616 25.6938 25.2157 25.6932 24.4378Z"
                          fill="black"
                        />
                        <path
                          d="M32.9425 14.2172C33.0514 14.217 33.1569 14.1791 33.2409 14.1099C33.325 14.0406 33.3825 13.9444 33.4036 13.8376C33.4247 13.7307 33.4081 13.6199 33.3567 13.5239C33.3053 13.4279 33.2222 13.3527 33.1215 13.3111C33.0209 13.2695 32.9089 13.2641 32.8047 13.2957C32.7005 13.3274 32.6105 13.3942 32.55 13.4848C32.4895 13.5753 32.4623 13.684 32.473 13.7924C32.4836 13.9008 32.5315 14.0021 32.6085 14.0792C32.6524 14.123 32.7044 14.1578 32.7617 14.1815C32.819 14.2052 32.8805 14.2173 32.9425 14.2172Z"
                          fill="black"
                        />
                        <path
                          d="M24.3355 34.668C24.2269 34.6685 24.1218 34.7067 24.0382 34.776C23.9545 34.8454 23.8975 34.9415 23.8768 35.0481C23.8561 35.1548 23.8729 35.2653 23.9245 35.3609C23.9761 35.4565 24.0592 35.5312 24.1597 35.5725C24.2603 35.6137 24.3719 35.6188 24.4758 35.5869C24.5796 35.555 24.6692 35.4882 24.7293 35.3977C24.7894 35.3072 24.8163 35.1987 24.8054 35.0906C24.7945 34.9825 24.7465 34.8816 24.6695 34.8049C24.5806 34.7169 24.4606 34.6677 24.3355 34.668Z"
                          fill="black"
                        />
                      </mask>
                      <g mask="url(#mask0_342_51)">
                        <rect width="70" height="70" fill="#E0434D" />
                      </g>
                    </svg>
                  </a>
                  <!-- <div class="border-l border-slate-700 pl-3">
                    <p class="text-1xl block font-medium">Board Settings</p>
                    <p class="text-sm opacity-80">Start to simple</p>
                  </div> -->
                  <div>
                    <button @click="togglePopup('isBoardSettingsPopupVisible')">
                      <div class="border-l border-slate-700 pl-3">
                        <p class="text-1xl block font-medium">Board Settings</p>
                      </div>
                      <p class="text-sm opacity-80 border-l border-slate-700">
                        Start to simple
                      </p>
                    </button>
                    <div
                      v-if="isBoardSettingsPopupVisible"
                      class="popup-overlay"
                    >
                      <div class="popup-content">
                        <button
                          class="close-btn"
                          @click="togglePopup('isBoardSettingsPopupVisible')"
                        >
                          X
                        </button>
                        <workspaceSettings
                          :existing_workspace="selectedWorkspace"
                        ></workspaceSettings>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="mb-8">
          <h2 class="text-md block font-medium ml-6">Latest Templates</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-6">
            <boardTemplateList></boardTemplateList>
          </div>
        </section>

        <section class="mb-8 sm">
          <h2 class="text-md block font-medium ml-6">Your Boards</h2>
          <div
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4 ml-2"
          >
            <div class="w-full h-screen overflow-y-auto">
              <div
                v-if="!selectedWorkspace"
                class="p-10 text-center text-gray-500"
              >
                Select a workspace to manage
              </div>
              <div v-else>
                <div
                  v-if="
                    !selectedWorkspace.lifetime_campaign &&
                    (selectedWorkspace.expired ||
                      selectedWorkspace.autocharge_failed)
                  "
                  class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6"
                >
                  <p v-if="selectedWorkspace.expired">
                    Your Chartmat subscription has expired. Access will be
                    restored once subscription is renewed.
                  </p>
                  <p v-else-if="selectedWorkspace.autocharge_failed">
                    Please review your payment method from manage subscription
                    in my accounts page.
                  </p>
                  <nuxt-link to="/dashboard/account" class="btn btn-red mt-2"
                    >Renew Plan</nuxt-link
                  >
                </div>
                <div class="p-4">
                  <div v-if="tab === 'boards'" class="grid grid-cols-2 gap-4">
                    <!-- <template
                      v-if="
                        !selectedWorkspace.boards ||
                        !selectedWorkspace.boards.length
                      "
                    >
                      <div class="col-span-3 text-center">
                        <p class="mb-4">
                          This workspace doesn't have any boards yet.
                        </p>
                        <button @click="tab = 'new'" class="btn btn-indigo">
                          New Board
                        </button>
                      </div>
                    </template> -->
                    <template>
                      <div
                        v-for="board in selectedWorkspace.boards"
                        :key="board.id"
                        class="board border border-red-400 rounded p-2"
                      >
                        <div class="inline-flex items-center">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 mr-1 text-gray-700 stroke-current"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                            />
                          </svg>
                          <p class="font-semibold">
                            {{
                              board.name || board.title || `Board ${board.id}`
                            }}
                          </p>
                        </div>
                        <div class="flex flex-wrap mt-1">
                          <p
                            v-show="!board.public"
                            class="text-xs font-semibold inline-flex items-center mr-2 rounded-full text-gray-500"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              class="h-4 w-4 mr-2 text-rose-600 stroke-current"
                              fill="none"
                              viewBox="0 0 24 24"
                              stroke="currentColor"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                              />
                            </svg>
                            Private
                          </p>

                          <p
                            v-show="board.public"
                            class="text-xs font-semibold inline-flex items-center mr-2 rounded-full text-gray-500"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              class="h-4 w-4 mr-2 text-teal-600 stroke-current"
                              fill="none"
                              viewBox="0 0 24 24"
                              stroke="currentColor"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"
                              />
                            </svg>
                            Public
                          </p>

                          <p
                            class="text-xs font-semibold inline-flex items-center mr-2 rounded-full text-gray-500"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              class="h-5 w-5 mr-2 text-emerald-500 stroke-current"
                              fill="none"
                              viewBox="0 0 24 24"
                              stroke="currentColor"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="1"
                                d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"
                              />
                            </svg>
                            {{ board.title || board.spreadsheetId }}
                          </p>

                          <p
                            class="text-xs font-semibold inline-flex items-center mr-2 rounded-full text-gray-500"
                          >
                            <svg
                              class="h-5 w-5 mr-2 text-indigo-500 stroke-current"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
                              ></path>
                            </svg>
                            {{ board.path }}
                          </p>
                        </div>
                        <div
                          class="w-full border-t border-gray-200 py-2 mt-2 text-sm flex items-center justify-start"
                        >
                          <button
                            :class="{ loading: cloning_id === board.id }"
                            class="bg-yellow-50 flex items-center border border-yellow-300 text-yellow-700 px-3 font-semibold py-1 rounded mr-3"
                            @click="cloneBoard(board)"
                          >
                            Clone Board
                            <svg
                              class="w-5 h-5 ml-2"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                              ></path>
                            </svg>
                          </button>
                          <a
                            :href="`//${selectedWorkspace.subdomain}.${$config.CHARTMAT_BOARD_BASE_URL}/${board.path}`"
                            class="bg-indigo-50 flex items-center border border-indigo-300 text-indigo-700 px-3 font-semibold py-1 rounded"
                          >
                            View Board
                            <svg
                              class="w-5 h-5 ml-2"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M14 5l7 7m0 0l-7 7m7-7H3"
                              ></path>
                            </svg>
                          </a>
                        </div>
                      </div>
                    </template>
                  </div>

                  <!-- <div v-if="tab === 'settings'">
                    <workspaceSettings
                      :existing_workspace="selectedWorkspace"
                    ></workspaceSettings>
                  </div> -->

                  <!-- <div v-if="tab === 'new'">
                    <boardNew :workspace="selectedWorkspace"></boardNew>
                  </div> -->
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>
</template>

<script>
import workspaceSettings from "../components/workspaceSettings.vue";
import boardNew from "../components/board/new.vue";

export default {
  middleware: "auth",
  layout: "default",
  fetchOnServer: false,
  components: {
    workspaceSettings,
    boardNew,
  },

  head() {
    return {
      title: "Workspaces",
    };
  },
  data() {
    return {
      workspaces: [],
      selectedWorkspace: { token_scope: "default_scope" },
      isAddPopupVisible: false,
      isStartFromScratchPopupVisible: false,
      isStartFromTemplatesPopupVisible: false,
      isBoardSettingsPopupVisible: false,
      tab: "boards",
      cloning_id: null,
      errorMessage: null,
      workspace: {},
      user: {},
    };
  },
  // async fetch() {
  //   try {
  //     this.workspaces = await this.$axios.$get("/api/workspaces");
  //     this.workspaces.forEach((workspace) => {
  //       this.$set(workspace, "collapsed", true);
  //     });

  //     // const workspace = await this.$axios.$get(`/api/board/workspace`);
  //     // this.workspace = workspace ?? {};
  //   } catch (error) {
  //     console.error("Error fetching workspaces:", error);
  //     this.errorMessage = "Failed to load workspaces. Please try again later.";
  //   }
  // },
  async fetch() {
  this.workspaces = await this.$axios.$get("/api/workspaces");
  this.workspaces.forEach((workspace) => {
    this.$set(workspace, "collapsed", true);
  });
},
  computed: {
    role() {
      const arr = this.workspaces.map((w) => [
        w.id,
        w.users.find((u) => u.email).role,
      ]);
      return Object.fromEntries(arr);
    },
    users() {
      const arr = this.workspaces.map((w) => [
        w.id,
        {
          admins: w.users
            .filter((u) => u.role === "admin")
            .map((e) => e.email)
            .join(", "),
          guests: w.users
            .filter((u) => u.role === "guest")
            .map((e) => e.email)
            .join(", "),
        },
      ]);
      return Object.fromEntries(arr);
    },
    email() {
      return this.$auth?.user?.email;
    },
  },
  methods: {
    toggleWorkspace(index) {
      this.$set(
        this.workspaces[index],
        "collapsed",
        !this.workspaces[index].collapsed
      );
    },
    togglePopup(popupType) {
      this[popupType] = !this[popupType];
      
    },
    logout() {
      this.$auth.logout();
      window.location.href = `//${this.$config.CHARTMAT_BOARD_BASE_URL}/dashboard`;
    },
    // async selectWorkspace(workspace) {
    //   this.selectedWorkspace = workspace;
    //   this.errorMessage = null;
    //   try {
    //     const params = new URLSearchParams({
    //       board: "new-admin",
    //       referer: `${window.location.origin}/new-admin`,
    //       _id: workspace.id,
    //       _email: this.$auth.user.email,
    //     });
    //     const workspaceDetails = await this.$axios.$get(
    //       `/api/board/workspace?${params.toString()}`
    //     );
    //     this.selectedWorkspace = { ...workspace, ...workspaceDetails };
    //   } catch (error) {
    //     console.error("Error fetching workspace details:", error);
    //     if (error.response) {
    //       console.error("Response data:", error.response.data);
    //       console.error("Response status:", error.response.status);
    //       console.error("Response headers:", error.response.headers);
    //     }
    //     if (!this.$auth.loggedIn) {
    //       window.location.href = `//${this.$config.CHARTMAT_BOARD_BASE_URL}/dashboard/auth`;
    //     } else {
    //       this.errorMessage =
    //         "Failed to load workspace details. Please try again later.";
    //     }
    //   }
    // },
    async selectWorkspace(workspace) {
    // Check if workspace object and its id are valid
    if (!workspace || !workspace.id) {
      this.errorMessage = "Invalid workspace data.";
      console.error("Invalid workspace data:", workspace);
      return;
    }

    this.selectedWorkspace = workspace;
    this.errorMessage = null;

    try {
     
      const params = new URLSearchParams({
        board: "new-admin",
        referer: `${window.location.origin}/new-admin`,
        _id: workspace.id,
        _email: this.$auth.user.email,
      });

       console.log("Fetching workspace details with params:", params.toString());

        const workspaceDetails = await this.$axios.$get(
          `/api/board/workspace-info?${params.toString()}`
        );

        console.log("Workspace details fetched:", workspaceDetails);
        this.selectedWorkspace = { ...workspace, ...workspaceDetails };
    } catch (error) {
      console.error("Error fetching workspace details:", error);
      if (error.response) {
        console.error("Response data:", error.response.data);
        console.error("Response status:", error.response.status);
        console.error("Response headers:", error.response.headers);
      }

      if (!this.$auth.loggedIn) {
        if (this.$config && this.$config.CHARTMAT_BOARD_BASE_URL) {
          window.location.href = `//${this.$config.CHARTMAT_BOARD_BASE_URL}/dashboard/auth`;
        } else {
          console.error("Configuration error: CHARTMAT_BOARD_BASE_URL is not defined.");
        }
      } else {
        this.errorMessage =
          "Failed to load workspace details. Please try again later.";
      }
    }
    },
    async cloneBoard(board) {
      this.cloning_id = board.id;
      const path = board.path.split("-clone-")[0] + `-clone-${+new Date()}`;
      const clone = {
        ...board,
        path,
      };
      delete clone.id;
      try {
        const created = await this.$axios.$post("/api/board", {
          ...clone,
          workspace: this.selectedWorkspace.id,
        });
        this.selectedWorkspace.boards.push(created);
      } catch (error) {
        console.error("Error cloning board:", error);
        this.errorMessage = "Failed to clone board. Please try again later.";
      } finally {
        this.cloning_id = null;
      }
    },
  },
  // watch: {
  //   tab(newTab) {
  //     if (newTab === 'settings') {
  //       this.popupVisible = true;
  //     }
  //   }
  // },
};
</script>

<style scoped>
.sidebar {
  width: 300px;
  /* height: auto; */
}
.flex {
  display: flex;
}

.flex-1 {
  flex: 1;
}

main {
  flex: 1;
}
.arrow-down {
  transform: rotate(90deg);
}
.arrow-right {
  transform: rotate(0deg);
}
.workspace-item {
  display: flex;
  justify-content: space-between;
}
.workspace-header {
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.toggle-arrow {
  transition: transform 0.3s ease;
}
.workspace-header h2 {
  margin: 0;
}

.workspace-container {
  display: flex;
  flex-direction: column;
}
.circle-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px; /* Adjust the size as needed */
  height: 16px;
  border-radius: 50%;
  /* background-color: #007bff;  */
  border: 2px solid #000000;
  cursor: pointer;
  padding: 0;
}

.circle-button svg {
  color: rgb(0, 0, 0); /* Icon color */
  width: 16px;
  height: 16px;
}

.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  /* background: rgba(0, 0, 0, 0.5); */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.popup-content {
  background: white;
  height: 600px;
  width: auto;
  padding: 20px;
  border-radius: 8px;
  position: relative;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  overflow-y: auto;
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: transparent;
  border: none;
  font-size: 20px;
  cursor: pointer;
}
.add-popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  /* background: rgba(0, 0, 0, 0.5); */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.add-popup-content {
  background: white;
  height: 600px;
  width: 600px;
  padding: 20px;
  border-radius: 8px;
  position: relative;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  overflow-y: auto;
}

.add-close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: transparent;
  border: none;
  font-size: 20px;
  cursor: pointer;
}
.main {
  background-color: #e6e6e6;
}
.board {
  background-color: #e8efef;
  border: #000000;
}
</style>
